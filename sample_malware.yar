/*
    Telescan YARA Rules
    Sample malware detection rules
*/

rule suspicious_shell_script {
    meta:
        description = "Detects suspicious shell script patterns"
        severity = "high"
        author = "Telescan"
    
    strings:
        $download = /wget\s+.*http/i
        $execute = /\$\(.*\)/i
        $curl = /curl\s+.*\|\s*sh/i
        $base64 = /base64\s+-d/i
        $obfuscated = /\\x[0-9a-fA-F]{2}/
    
    condition:
        2 of them
}

rule suspicious_python_code {
    meta:
        description = "Detects suspicious Python code patterns"
        severity = "high"
        author = "Telescan"
    
    strings:
        $eval = /eval\s*\(\s*base64/i
        $exec = /exec\s*\(\s*[\"']/i
        $subprocess = /subprocess\.(call|run|Popen)/i
        $socket = /socket\.(socket|gethostbyname)/i
        $pty = /pty\.(spawn|spawnu)/i
    
    condition:
        1 of them
}

rule suspicious_php_code {
    meta:
        description = "Detects suspicious PHP code patterns"
        severity = "high"
        author = "Telescan"
    
    strings:
        $eval = /eval\s*\(\s*\$_(?:GET|POST|REQUEST)/i
        $shell = /shell_exec\s*\(\s*\$_(?:GET|POST|REQUEST)/i
        $system = /system\s*\(\s*\$_(?:GET|POST|REQUEST)/i
        $passthru = /passthru\s*\(\s*\$_(?:GET|POST|REQUEST)/i
        $popen = /popen\s*\(\s*\$_(?:GET|POST|REQUEST)/i
        $cmd = /`\$_(?:GET|POST|REQUEST)/i
    
    condition:
        1 of them
}

rule obfuscated_javascript {
    meta:
        description = "Detects obfuscated JavaScript"
        severity = "medium"
        author = "Telescan"
    
    strings:
        $hex = /\x[0-9a-fA-F]{2}/
        $unicode = /\\u[0-9a-fA-F]{4}/
        $eval_base64 = /eval\s*\(\s*atob\s*\(/i
        $document_cookie = /document\.cookie/i
        $iframe_inject = /document\.body\.innerHTML\s*=.*iframe/i
    
    condition:
        2 of them
}

rule known_malware_signature {
    meta:
        description = "Known malware signature"
        severity = "critical"
        author = "Telescan"
    
    strings:
        $mirai = "mirai" nocase
        $ransomware = "ransomware" nocase
        $trojan = "trojan" nocase
        $backdoor = "backdoor" nocase
        $botnet = "botnet" nocase
    
    condition:
        1 of them
}

rule suspicious_archive_content {
    meta:
        description = "Detects suspicious archive patterns"
        severity = "medium"
        author = "Telescan"
    
    strings:
        $exe_in_zip = /\.exe/i
        $script_in_archive = /\.(php|js|sh|bat|cmd)\s/i
        $hidden_file = /\.[a-zA-Z0-9_-]{5,}$/
    
    condition:
        2 of them
}

rule suspicious_document_macro {
    meta:
        description = "Detects suspicious document macros"
        severity = "high"
        author = "Telescan"
    
    strings:
        $autoopen = /AutoOpen/i
        $document_open = /Document_Open/i
        $workbook_open = /Workbook_Open/i
        $shell = /Shell\s*\(/i
        $cmd = /Cmd\s*\(\s*\"\/c/i
    
    condition:
        2 of them
}
